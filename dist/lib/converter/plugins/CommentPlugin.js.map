{"version":3,"file":"CommentPlugin.js","sourceRoot":"","sources":["../../../../src/lib/converter/plugins/CommentPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import * as ts from 'typescript';\r\n\r\nimport { Comment, CommentTag } from '../../models/comments/index';\r\nimport { IntrinsicType } from '../../models/types/index';\r\nimport { Reflection, ReflectionFlag, ReflectionKind, TraverseProperty,\r\n    TypeParameterReflection, DeclarationReflection, ProjectReflection,\r\n    SignatureReflection, ParameterReflection } from '../../models/reflections/index';\r\nimport { Component, ConverterComponent } from '../components';\r\nimport { parseComment, getRawComment } from '../factories/comment';\r\nimport { Converter } from '../converter';\r\nimport { Context } from '../context';\r\n\r\n/**\r\n * Structure used by [[ContainerCommentHandler]] to store discovered module comments.\r\n */\r\ninterface ModuleComment {\r\n    /**\r\n     * The module reflection this comment is targeting.\r\n     */\r\n    reflection: Reflection;\r\n\r\n    /**\r\n     * The full text of the best matched comment.\r\n     */\r\n    fullText: string;\r\n\r\n    /**\r\n     * Has the full text been marked as being preferred?\r\n     */\r\n    isPreferred: boolean;\r\n}\r\n\r\n/**\r\n * A handler that parses javadoc comments and attaches [[Models.Comment]] instances to\r\n * the generated reflections.\r\n */\r\n@Component({name: 'comment'})\r\nexport class CommentPlugin extends ConverterComponent {\r\n    /**\r\n     * List of discovered module comments.\r\n     * Defined in this.onBegin\r\n     */\r\n    private comments!: {[id: number]: ModuleComment};\r\n\r\n    /**\r\n     * List of hidden reflections.\r\n     */\r\n    private hidden?: Reflection[];\r\n\r\n    /**\r\n     * Create a new CommentPlugin instance.\r\n     */\r\n    initialize() {\r\n        this.listenTo(this.owner, {\r\n            [Converter.EVENT_BEGIN]:                   this.onBegin,\r\n            [Converter.EVENT_CREATE_DECLARATION]:      this.onDeclaration,\r\n            [Converter.EVENT_CREATE_SIGNATURE]:        this.onDeclaration,\r\n            [Converter.EVENT_CREATE_TYPE_PARAMETER]:   this.onCreateTypeParameter,\r\n            [Converter.EVENT_FUNCTION_IMPLEMENTATION]: this.onFunctionImplementation,\r\n            [Converter.EVENT_RESOLVE_BEGIN]:           this.onBeginResolve,\r\n            [Converter.EVENT_RESOLVE]:                 this.onResolve\r\n        });\r\n    }\r\n\r\n    private storeModuleComment(comment: string, reflection: Reflection) {\r\n        const isPreferred = (comment.toLowerCase().indexOf('@preferred') !== -1);\r\n\r\n        if (this.comments[reflection.id]) {\r\n            const info = this.comments[reflection.id];\r\n            if (!isPreferred && (info.isPreferred || info.fullText.length > comment.length)) {\r\n                return;\r\n            }\r\n\r\n            info.fullText    = comment;\r\n            info.isPreferred = isPreferred;\r\n        } else {\r\n            this.comments[reflection.id] = {\r\n                reflection:  reflection,\r\n                fullText:    comment,\r\n                isPreferred: isPreferred\r\n            };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Apply all comment tag modifiers to the given reflection.\r\n     *\r\n     * @param reflection  The reflection the modifiers should be applied to.\r\n     * @param comment  The comment that should be searched for modifiers.\r\n     */\r\n    private applyModifiers(reflection: Reflection, comment: Comment) {\r\n        if (comment.hasTag('private')) {\r\n            reflection.setFlag(ReflectionFlag.Private);\r\n            CommentPlugin.removeTags(comment, 'private');\r\n        }\r\n\r\n        if (comment.hasTag('protected')) {\r\n            reflection.setFlag(ReflectionFlag.Protected);\r\n            CommentPlugin.removeTags(comment, 'protected');\r\n        }\r\n\r\n        if (comment.hasTag('public')) {\r\n            reflection.setFlag(ReflectionFlag.Public);\r\n            CommentPlugin.removeTags(comment, 'public');\r\n        }\r\n\r\n        if (comment.hasTag('event')) {\r\n            reflection.kind = ReflectionKind.Event;\r\n            // reflection.setFlag(ReflectionFlag.Event);\r\n            CommentPlugin.removeTags(comment, 'event');\r\n        }\r\n\r\n        if (comment.hasTag('hidden') || comment.hasTag('ignore')) {\r\n            if (!this.hidden) {\r\n                this.hidden = [];\r\n            }\r\n            this.hidden.push(reflection);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter begins converting a project.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     */\r\n    private onBegin(context: Context) {\r\n        this.comments = {};\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter has created a type parameter reflection.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     * @param reflection  The reflection that is currently processed.\r\n     * @param node  The node that is currently processed if available.\r\n     */\r\n    private onCreateTypeParameter(context: Context, reflection: TypeParameterReflection, node?: ts.Node) {\r\n        const comment = reflection.parent && reflection.parent.comment;\r\n        if (comment) {\r\n            let tag = comment.getTag('typeparam', reflection.name);\r\n            if (!tag) {\r\n                tag = comment.getTag('param', `<${reflection.name}>`);\r\n            }\r\n            if (!tag) {\r\n                tag = comment.getTag('param', reflection.name);\r\n            }\r\n\r\n            if (tag) {\r\n                reflection.comment = new Comment(tag.text);\r\n                // comment.tags must be set if we found a tag.\r\n                comment.tags!.splice(comment.tags!.indexOf(tag), 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter has created a declaration or signature reflection.\r\n     *\r\n     * Invokes the comment parser.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     * @param reflection  The reflection that is currently processed.\r\n     * @param node  The node that is currently processed if available.\r\n     */\r\n    private onDeclaration(context: Context, reflection: Reflection, node?: ts.Node) {\r\n        if (!node) {\r\n            return;\r\n        }\r\n        const rawComment = getRawComment(node);\r\n        if (!rawComment) {\r\n            return;\r\n        }\r\n\r\n        if (reflection.kindOf(ReflectionKind.FunctionOrMethod) || (reflection.kindOf(ReflectionKind.Event) && reflection['signatures'])) {\r\n            const comment = parseComment(rawComment, reflection.comment);\r\n            this.applyModifiers(reflection, comment);\r\n        } else if (reflection.kindOf(ReflectionKind.Module)) {\r\n            this.storeModuleComment(rawComment, reflection);\r\n        } else {\r\n            const comment = parseComment(rawComment, reflection.comment);\r\n            this.applyModifiers(reflection, comment);\r\n            reflection.comment = comment;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter has found a function implementation.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     * @param reflection  The reflection that is currently processed.\r\n     * @param node  The node that is currently processed if available.\r\n     */\r\n    private onFunctionImplementation(context: Context, reflection: Reflection, node?: ts.Node) {\r\n        if (!node) {\r\n            return;\r\n        }\r\n\r\n        const comment = getRawComment(node);\r\n        if (comment) {\r\n            reflection.comment = parseComment(comment, reflection.comment);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter begins resolving a project.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     */\r\n    private onBeginResolve(context: Context) {\r\n        for (let id in this.comments) {\r\n            if (!this.comments.hasOwnProperty(id)) {\r\n                continue;\r\n            }\r\n\r\n            const info    = this.comments[id];\r\n            const comment = parseComment(info.fullText);\r\n            CommentPlugin.removeTags(comment, 'preferred');\r\n\r\n            this.applyModifiers(info.reflection, comment);\r\n            info.reflection.comment = comment;\r\n        }\r\n\r\n        if (this.hidden) {\r\n            const project = context.project;\r\n            this.hidden.forEach((reflection) => {\r\n                CommentPlugin.removeReflection(project, reflection);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Triggered when the converter resolves a reflection.\r\n     *\r\n     * Cleans up comment tags related to signatures like @param or @return\r\n     * and moves their data to the corresponding parameter reflections.\r\n     *\r\n     * This hook also copies over the comment of function implementations to their\r\n     * signatures.\r\n     *\r\n     * @param context  The context object describing the current state the converter is in.\r\n     * @param reflection  The reflection that is currently resolved.\r\n     */\r\n    private onResolve(context: Context, reflection: DeclarationReflection) {\r\n        if (!(reflection instanceof DeclarationReflection)) {\r\n            return;\r\n        }\r\n\r\n        const signatures = reflection.getAllSignatures();\r\n        if (signatures.length) {\r\n            const comment = reflection.comment;\r\n            if (comment && comment.hasTag('returns')) {\r\n                comment.returns = comment.getTag('returns')!.text;\r\n                CommentPlugin.removeTags(comment, 'returns');\r\n            }\r\n\r\n            signatures.forEach((signature) => {\r\n                let childComment = signature.comment;\r\n                if (childComment && childComment.hasTag('returns')) {\r\n                    childComment.returns = childComment.getTag('returns')!.text;\r\n                    CommentPlugin.removeTags(childComment, 'returns');\r\n                }\r\n\r\n                if (comment) {\r\n                    if (!childComment) {\r\n                        childComment = signature.comment = new Comment();\r\n                    }\r\n\r\n                    childComment.shortText = childComment.shortText || comment.shortText;\r\n                    childComment.text      = childComment.text      || comment.text;\r\n                    childComment.returns   = childComment.returns   || comment.returns;\r\n                }\r\n\r\n                if (signature.parameters) {\r\n                    signature.parameters.forEach((parameter) => {\r\n                        let tag: CommentTag | undefined;\r\n                        if (childComment) {\r\n                            tag = childComment.getTag('param', parameter.name);\r\n                        }\r\n                        if (comment && !tag) {\r\n                            tag = comment.getTag('param', parameter.name);\r\n                        }\r\n                        if (tag) {\r\n                            parameter.comment = new Comment(tag.text);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                CommentPlugin.removeTags(childComment, 'param');\r\n            });\r\n\r\n            CommentPlugin.removeTags(comment, 'param');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove all tags with the given name from the given comment instance.\r\n     *\r\n     * @param comment  The comment that should be modified.\r\n     * @param tagName  The name of the that that should be removed.\r\n     */\r\n    static removeTags(comment: Comment | undefined, tagName: string) {\r\n        if (!comment || !comment.tags) {\r\n            return;\r\n        }\r\n\r\n        let i = 0, c = comment.tags.length;\r\n        while (i < c) {\r\n            if (comment.tags[i].tagName === tagName) {\r\n                comment.tags.splice(i, 1);\r\n                c--;\r\n            } else {\r\n                i++;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove the given reflection from the project.\r\n     */\r\n    static removeReflection(project: ProjectReflection, reflection: Reflection) {\r\n        reflection.traverse((child) => CommentPlugin.removeReflection(project, child));\r\n\r\n        const parent = <DeclarationReflection> reflection.parent;\r\n        parent.traverse((child: Reflection, property: TraverseProperty) => {\r\n            if (child === reflection) {\r\n                switch (property) {\r\n                    case TraverseProperty.Children:\r\n                        if (parent.children) {\r\n                            const index = parent.children.indexOf(<DeclarationReflection> reflection);\r\n                            if (index !== -1) {\r\n                                parent.children.splice(index, 1);\r\n                            }\r\n                        }\r\n                        break;\r\n                    case TraverseProperty.GetSignature:\r\n                        delete parent.getSignature;\r\n                        break;\r\n                    case TraverseProperty.IndexSignature:\r\n                        delete parent.indexSignature;\r\n                        break;\r\n                    case TraverseProperty.Parameters:\r\n                        if ((<SignatureReflection> reflection.parent).parameters) {\r\n                            const index = (<SignatureReflection> reflection.parent).parameters!.indexOf(<ParameterReflection> reflection);\r\n                            if (index !== -1) {\r\n                                (<SignatureReflection> reflection.parent).parameters!.splice(index, 1);\r\n                            }\r\n                        }\r\n                        break;\r\n                    case TraverseProperty.SetSignature:\r\n                        delete parent.setSignature;\r\n                        break;\r\n                    case TraverseProperty.Signatures:\r\n                        if (parent.signatures) {\r\n                            const index = parent.signatures.indexOf(<SignatureReflection> reflection);\r\n                            if (index !== -1) {\r\n                                parent.signatures.splice(index, 1);\r\n                            }\r\n                        }\r\n                        break;\r\n                    case TraverseProperty.TypeLiteral:\r\n                        parent.type = new IntrinsicType('Object');\r\n                        break;\r\n                    case TraverseProperty.TypeParameter:\r\n                        if (parent.typeParameters) {\r\n                            const index = parent.typeParameters.indexOf(<TypeParameterReflection> reflection);\r\n                            if (index !== -1) {\r\n                                parent.typeParameters.splice(index, 1);\r\n                            }\r\n                        }\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n\r\n        let id = reflection.id;\r\n        delete project.reflections[id];\r\n\r\n        for (let key in project.symbolMapping) {\r\n            if (project.symbolMapping.hasOwnProperty(key) && project.symbolMapping[key] === id) {\r\n                delete project.symbolMapping[key];\r\n            }\r\n        }\r\n    }\r\n}\r\n"]}