{"version":3,"file":"arguments.js","sourceRoot":"","sources":["../../../../../src/lib/utils/options/readers/arguments.ts"],"names":[],"mappings":"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","sourcesContent":["import * as ts from 'typescript';\r\nimport * as _ts from '../../../ts-internal';\r\n\r\nimport { Component } from '../../component';\r\nimport { DiscoverEvent, OptionsComponent } from '../options';\r\nimport { ParameterType } from '../declaration';\r\n\r\n@Component({name: 'options:arguments'})\r\nexport class ArgumentsReader extends OptionsComponent {\r\n    initialize() {\r\n        this.listenTo(this.owner, DiscoverEvent.DISCOVER, this.onDiscover, -200);\r\n    }\r\n\r\n    onDiscover(event: DiscoverEvent) {\r\n        if (this.application.isCLI) {\r\n            this.parseArguments(event);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Read and store the given list of arguments.\r\n     *\r\n     * @param args  The list of arguments that should be parsed. When omitted the\r\n     *   current command line arguments will be used.\r\n     * @param ignoreUnknownArgs  Should unknown arguments be ignored? If so the parser\r\n     *   will simply skip all unknown arguments.\r\n     * @returns TRUE on success, otherwise FALSE.\r\n     */\r\n    private parseArguments(event: DiscoverEvent, args?: string[]) {\r\n        let index = 0;\r\n        const owner = this.owner;\r\n        args = args || process.argv.slice(2);\r\n\r\n        function readArgument(arg: string) {\r\n            const declaration = owner.getDeclaration(arg);\r\n            if (!declaration) {\r\n                event.addError('Unknown option: %s', arg);\r\n            } else if (declaration.type !== ParameterType.Boolean) {\r\n                if (!args[index]) {\r\n                    event.addError('Option \"%s\" expects an argument', declaration.name);\r\n                } else {\r\n                    event.data[declaration.name] = args[index++];\r\n                }\r\n            } else {\r\n                event.data[declaration.name] = true;\r\n            }\r\n        }\r\n\r\n        const files = [];\r\n        while (index < args.length) {\r\n            const arg = args[index++];\r\n\r\n            if (arg.charCodeAt(0) === _ts.CharacterCodes.at) {\r\n                this.parseResponseFile(event, arg.slice(1));\r\n            } else if (arg.charCodeAt(0) === _ts.CharacterCodes.minus) {\r\n                readArgument(arg.slice(arg.charCodeAt(1) === _ts.CharacterCodes.minus ? 2 : 1).toLowerCase());\r\n            } else {\r\n                files.push(arg);\r\n            }\r\n        }\r\n        if (files && files.length > 0) {\r\n            event.inputFiles = files;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Read the arguments stored in the given file.\r\n     *\r\n     * @param filename  The path and filename that should be parsed.\r\n     * @param ignoreUnknownArgs  Should unknown arguments be ignored?\r\n     * @returns TRUE on success, otherwise FALSE.\r\n     */\r\n    private parseResponseFile(event: DiscoverEvent, filename: string) {\r\n        const text = ts.sys.readFile(filename);\r\n        if (!text) {\r\n            event.addError('File not found: \"%s\"', filename);\r\n            return;\r\n        }\r\n\r\n        const args: string[] = [];\r\n        let pos = 0;\r\n        while (true) {\r\n            while (pos < text.length && text.charCodeAt(pos) <= _ts.CharacterCodes.space) {\r\n                pos++;\r\n            }\r\n            if (pos >= text.length) {\r\n                break;\r\n            }\r\n\r\n            const start = pos;\r\n            if (text.charCodeAt(start) === _ts.CharacterCodes.doubleQuote) {\r\n                pos++;\r\n                while (pos < text.length && text.charCodeAt(pos) !== _ts.CharacterCodes.doubleQuote) {\r\n                    pos++;\r\n                }\r\n                if (pos < text.length) {\r\n                    args.push(text.substring(start + 1, pos));\r\n                    pos++;\r\n                } else {\r\n                    event.addError('Unterminated quoted string in response file \"%s\"', filename);\r\n                    return;\r\n                }\r\n            } else {\r\n                while (text.charCodeAt(pos) > _ts.CharacterCodes.space) {\r\n                    pos++;\r\n                }\r\n                args.push(text.substring(start, pos));\r\n            }\r\n        }\r\n\r\n        this.parseArguments(event, args);\r\n    }\r\n}\r\n"]}