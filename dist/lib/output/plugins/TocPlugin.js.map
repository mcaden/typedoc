{"version":3,"file":"TocPlugin.js","sourceRoot":"","sources":["../../../../src/lib/output/plugins/TocPlugin.ts"],"names":[],"mappings":"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","sourcesContent":["import { Reflection, ReflectionKind, ProjectReflection, DeclarationReflection } from '../../models/reflections/index';\r\nimport { Component, RendererComponent } from '../components';\r\nimport { PageEvent } from '../events';\r\nimport { NavigationItem } from '../models/NavigationItem';\r\n\r\n/**\r\n * A plugin that generates a table of contents for the current page.\r\n *\r\n * The table of contents will start at the nearest module or dynamic module. This plugin\r\n * sets the [[PageEvent.toc]] property.\r\n */\r\n@Component({name: 'toc'})\r\nexport class TocPlugin extends RendererComponent {\r\n    /**\r\n     * Create a new TocPlugin instance.\r\n     */\r\n    initialize() {\r\n        this.listenTo(this.owner, {\r\n            [PageEvent.BEGIN]: this.onRendererBeginPage\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Triggered before a document will be rendered.\r\n     *\r\n     * @param page  An event object describing the current render operation.\r\n     */\r\n    private onRendererBeginPage(page: PageEvent) {\r\n        let model = page.model;\r\n        if (!(model instanceof Reflection)) {\r\n            return;\r\n        }\r\n\r\n        const trail: Reflection[] = [];\r\n        while (!(model instanceof ProjectReflection) && !model.kindOf(ReflectionKind.SomeModule)) {\r\n            trail.unshift(model);\r\n            model = model.parent;\r\n        }\r\n\r\n        const tocRestriction = this.owner.toc;\r\n        page.toc = new NavigationItem();\r\n        TocPlugin.buildToc(model, trail, page.toc, tocRestriction);\r\n    }\r\n\r\n    /**\r\n     * Create a toc navigation item structure.\r\n     *\r\n     * @param model   The models whose children should be written to the toc.\r\n     * @param trail   Defines the active trail of expanded toc entries.\r\n     * @param parent  The parent [[NavigationItem]] the toc should be appended to.\r\n     * @param restriction  The restricted table of contents.\r\n     */\r\n    static buildToc(model: Reflection, trail: Reflection[], parent: NavigationItem, restriction?: string[]) {\r\n        const index = trail.indexOf(model);\r\n        const children = model['children'] || [];\r\n\r\n        if (index < trail.length - 1 && children.length > 40) {\r\n            const child = trail[index + 1];\r\n            const item = NavigationItem.create(child, parent, true);\r\n            item.isInPath  = true;\r\n            item.isCurrent = false;\r\n            TocPlugin.buildToc(child, trail, item);\r\n        } else {\r\n            children.forEach((child: DeclarationReflection) => {\r\n\r\n                if (restriction && restriction.length > 0 && restriction.indexOf(child.name) === -1) {\r\n                    return;\r\n                }\r\n\r\n                if (child.kindOf(ReflectionKind.SomeModule)) {\r\n                    return;\r\n                }\r\n\r\n                const item = NavigationItem.create(child, parent, true);\r\n                if (trail.indexOf(child) !== -1) {\r\n                    item.isInPath  = true;\r\n                    item.isCurrent = (trail[trail.length - 1] === child);\r\n                    TocPlugin.buildToc(child, trail, item);\r\n                }\r\n            });\r\n        }\r\n    }\r\n}\r\n"]}